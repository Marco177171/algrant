{% extends './conversation_base.html' %}

{% block main %}
<div id="chat-container">
    {% if messages %}
        {% for message in messages %}
            {% if message.sender == request.user %}
                <div class="divider"></div>
                <div style="text-align: right;">
                    <a href="{% url 'user_profile' username=message.sender.username %}">{{message.sender.username}}</a>
                    <span>{{message.timestamp}}</span>
                    <p>{{message.content}}</p>
                    <span>message moves:</span>
                    <form action="{% url 'delete_message' %}" id="delete-message-form-{{ message.id }}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="message_id" value="{{ message.id }}">
                        <input type="hidden" name="conversation_id" value="{{ conversation.id }}">
                        <a href="#" onclick="document.getElementById('delete-message-form-{{ message.id }}').submit(); return false;">Delete</a>
                    </form>
                </div>
            {% else %}
                <div class="divider"></div>
                <a href="{% url 'user_profile' username=message.sender.username %}">{{message.sender.username}}</a>
                <span>{{message.timestamp}}</span>
                <p>{{message.content}}</p>
            {% endif %}
        {% endfor %}
    {% else %}
    <h3>No messages yet</h3>
    <p>You can start writing or add people to the chat from <a href="{% url 'chat_settings' conversation_id=conversation.id %}">chat settings</a></p>
    {% endif %}
    <a name="pointToScrollTo"></a>
</div>
{% endblock %}

{% block main_bottom %}
    <form action="{% url 'new_message' conversation_id=conversation.id %}" method="post">
        {% csrf_token %}
        <input class="search" type="text" name="message_text" placeholder="Write your message here" required>
    </form>
{% endblock %}

<div class="explorer">
    {% block explorer %}
    <a href="{% url 'chat_settings' conversation_id=conversation.id %}">Chat Settings</a>
    {% endblock %}
</div>

<script>
    // Scroll to the bottom when the DOM content is fully loaded
    document.addEventListener("DOMContentLoaded", function() {
        scrollToBottom();
    });

    // Scroll to the bottom function
    function scrollToBottom() {
        var chatContainer = document.getElementById("chat-container");
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Optionally, you can call scrollToBottom() after new messages are added dynamically
</script>
